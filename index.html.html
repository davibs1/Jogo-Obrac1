<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>OBRAC â€” Jogo Digital - EducaÃ§Ã£o Antirracista</title>
<style>
  :root{
    --bg:#071025;--card:#0f1724;--accent:#60a5fa;--muted:#94a3b8;--white:#eef2ff;
    --purple:#7c3aed;--orange:#f59e0b;--green:#10b981;--blue:#3b82f6;
  }
  *{box-sizing:border-box}
  body{margin:0;min-height:100vh;background:linear-gradient(180deg,#041329,#061029);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial;color:var(--white);display:flex;align-items:center;justify-content:center;padding:16px}
  .app{width:min(1100px,98vw);background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:18px;box-shadow:0 10px 40px rgba(0,0,0,0.6)}
  h1{margin:0 0 8px 0;font-size:20px}
  .grid{display:grid;grid-template-columns:360px 1fr;gap:14px}
  .panel{background:rgba(255,255,255,0.02);padding:12px;border-radius:10px}
  button{background:var(--accent);border:none;color:#04203a;padding:8px 10px;border-radius:8px;cursor:pointer;font-weight:700}
  .secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
  input,select,textarea{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px;border-radius:8px;color:var(--white)}
  .card-view{min-height:170px;padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));display:flex;flex-direction:column;justify-content:flex-start;align-items:flex-start;gap:8px}
  .title{font-weight:800;letter-spacing:0.6px}
  .hint{color:var(--muted);font-size:14px}
  .players{display:flex;gap:8px;flex-wrap:wrap}
  .player{padding:8px 10px;border-radius:8px;background:rgba(255,255,255,0.02);min-width:140px}
  .die{padding:8px;border-radius:10px;background:rgba(255,255,255,0.01);display:flex;gap:8px;align-items:center}
  .options{display:flex;flex-direction:column;gap:8px;width:100%}
  .opt-btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px;border-radius:8px;text-align:left;color:var(--white);cursor:pointer}
  .opt-btn.disabled{opacity:0.5;cursor:not-allowed}
  .log{height:160px;overflow:auto;padding:8px;background:rgba(0,0,0,0.12);border-radius:8px;color:var(--muted);font-size:13px}
  .guess-row{display:flex;gap:8px;width:100%}
  .guess-row input{flex:1}
  footer{font-size:13px;color:var(--muted);margin-top:10px}
  @media (max-width:980px){.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
  <div class="app" role="application" aria-label="Jogo OBRAC â€” Pontos">
    <h1>OBRAC â€” Jogo Digital - EducaÃ§Ã£o Antirracista</h1>

    <div style="display:flex;gap:8px;align-items:center;margin-bottom:10px">
      <input id="playerName" placeholder="Nome do jogador" />
      <button id="addPlayer" class="secondary">Adicionar jogador</button>
      <button id="newGame">Nova partida</button>
      <div style="margin-left:auto;color:var(--muted)">Meta de vitÃ³ria: <strong id="goalLabel">40</strong> pts</div>
    </div>

    <div class="grid">
      <!-- esquerda: controle/jogadores/log -->
      <div class="panel">
        <div>
          <strong>Jogadores</strong>
          <div id="players" class="players" aria-live="polite"></div>
        </div>

        <div style="margin-top:10px">
          <strong>Placar</strong>
          <div id="scoreboard" style="margin-top:8px"></div>
        </div>

        <div style="margin-top:10px">
          <strong>Log</strong>
          <div id="log" class="log"></div>
        </div>
      </div>

      <!-- direita: aÃ§Ãµes, dado, carta -->
      <div class="panel" style="display:flex;flex-direction:column;gap:10px">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div style="display:flex;gap:12px;align-items:center">
            <div class="die">
              <button id="rollDie">ðŸŽ² Rodar dado</button>
              <div id="dieFace" style="font-size:13px;color:var(--muted)">Face: â€”</div>
            </div>
            <div>
              <label style="font-size:13px;color:var(--muted)">Se o dado der "Escolha seu tema", selecione aqui:</label><br/>
              <select id="manualTheme" style="margin-top:6px">
                <option value="personalidades_negras">PERSONALIDADES NEGRAS (Roxo)</option>
                <option value="locais">LOCAIS (Laranja)</option>
                <option value="fatos_historicos">FATOS HISTÃ“RICOS (Verde)</option>
                <option value="obras">OBRAS (Azul)</option>
              </select>
            </div>
          </div>

          <div style="text-align:right">
            <div><strong>Turno:</strong> <span id="turnLabel">â€”</span></div>
            <div><strong>PontuaÃ§Ã£o:</strong> <span id="scoreLabel">0</span></div>
            <div style="margin-top:6px"><button id="endGame" class="secondary">Encerrar partida</button></div>
          </div>
        </div>

        <div class="card-view" id="cardView">
          <div class="title" id="cardTitle">â€”</div>
          <div class="hint" id="cardMeta">â€”</div>

          <div style="width:100%;display:flex;flex-direction:column;gap:6px;margin-top:6px">
            <div style="display:flex;gap:8px;align-items:center">
              <div style="flex:1">
                <div class="hint" id="currentHint">Pressione o dado para escolher um tema e tirar uma carta.</div>
              </div>
              <div style="display:flex;flex-direction:column;gap:6px">
                <div>Dicas usadas: <span id="hintsUsed">0</span></div>
                <div>Pontos (se acertar): <strong id="cardPoints">0</strong></div>
              </div>
            </div>
          </div>

          <!-- Ã¡rea de opÃ§Ãµes (sÃ³ usada para cartas especiais) -->
          <div style="width:100%;margin-top:8px">
            <div id="options" class="options"></div>

            <!-- Ã¡rea de palpite livre (sÃ³ para cartas normais) -->
            <div id="guessArea" style="margin-top:8px;display:none">
              <div class="guess-row">
                <input id="guessInput" placeholder="Digite seu palpite"/>
                <button id="submitGuess">Enviar</button>
              </div>
            </div>
          </div>

          <div style="width:100%;display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
            <button id="askHint" class="secondary">Pedir dica</button>
            <button id="reveal" class="secondary">Revelar (0 pts)</button>
          </div>
        </div>

        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button id="nextTurn" class="secondary">PrÃ³ximo turno</button>
        </div>
      </div>
    </div>

    <footer style="margin-top:12px">OBRAC - Etapa II Fase II Componentes: Davi Barros, Evelyn Sales, Geovanni Santos e Isabelle Dutra</footer>
  </div>

<script>
/* ===========================
  VersÃ£o ajustada: alternativas SOMENTE nas cartas especiais.
  Cartas normais: palpite livre com tolerÃ¢ncia (Levenshtein + normalizaÃ§Ã£o).
===========================*/

/* ConfiguraÃ§Ãµes/estado (mantive os valores do Ãºltimo cÃ³digo) */
const GOAL = 40;
const POINT_MAP = [8,6,4,2,1];
const THEMES = [
  {key:'personalidades_negras', label:'PERSONALIDADES NEGRAS', color:'var(--purple)'},
  {key:'locais', label:'LOCAIS', color:'var(--orange)'},
  {key:'fatos_historicos', label:'FATOS HISTÃ“RICOS', color:'var(--green)'},
  {key:'obras', label:'OBRAS', color:'var(--blue)'}
];

let cardPools = { personalidades_negras: [], locais: [], fatos_historicos: [], obras: [] };
let players = []; // {name,score,lostTurn}
let currentPlayerIndex = 0;
let gameActive = false;
let currentCard = null;
let hintsUsed = 0;
let currentCardPoints = 0;
let dieLastFace = null;
let optionsLocked = false;

const $ = id => document.getElementById(id);
const logEl = $('log');
const playersEl = $('players');
const scoreboardEl = $('scoreboard');
const turnLabel = $('turnLabel');
const scoreLabel = $('scoreLabel');
const dieFaceEl = $('dieFace');
const cardTitle = $('cardTitle');
const cardMeta = $('cardMeta');
const currentHintEl = $('currentHint');
const hintsUsedEl = $('hintsUsed');
const cardPointsEl = $('cardPoints');
const optionsEl = $('options');
const guessArea = $('guessArea');
const guessInput = $('guessInput');

$('addPlayer').addEventListener('click', addPlayer);
$('newGame').addEventListener('click', startNewGame);
$('rollDie').addEventListener('click', rollDie);
$('askHint').addEventListener('click', askHint);
$('reveal').addEventListener('click', revealWord);
$('nextTurn').addEventListener('click', nextTurn);
$('endGame').addEventListener('click', endGame);
$('submitGuess').addEventListener('click', submitGuess);

/* util */
function log(msg){
  const now = new Date().toLocaleTimeString();
  logEl.innerHTML = `<div>[${now}] ${escapeHtml(msg)}</div>` + logEl.innerHTML;
}
function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;'); }

function addPlayer(){
  const name = $('playerName').value.trim();
  if(!name) return alert('Digite um nome.');
  players.push({name,score:0,lostTurn:false});
  $('playerName').value='';
  renderPlayers();
  log(`Jogador adicionado: ${name}`);
}
function renderPlayers(){
  playersEl.innerHTML = '';
  players.forEach((p,i)=>{
    const div = document.createElement('div');
    div.className='player';
    div.innerHTML = `<strong>${p.name}</strong><div style="font-size:13px;color:var(--muted)">Pontos: <span id="p-${i}">${p.score}</span> â€¢ Status: ${p.lostTurn ? '<em>Perdeu vez</em>' : 'OK'}</div>`;
    playersEl.appendChild(div);
  });
  renderScoreboard();
  updateStatus();
}
function renderScoreboard(){
  scoreboardEl.innerHTML = players.map((p,i)=>`<div style="padding:6px;border-bottom:1px solid rgba(255,255,255,0.03)"><strong>${p.name}</strong> â€” ${p.score} pts</div>`).join('');
}

/* Carrega cartas (mesmo conteÃºdo do cÃ³digo anterior) */
function loadAllCards(){
  const all = [
    // PERSONALIDADES NEGRAS (normais)
    {"theme":"personalidades_negras","type":"normal","word":"PelÃ©","hints":["conquistei trÃªs copas do mundo","sou o Rei do futebol","joguei pelo Santos Futebol Clube","tambÃ©m joguei pela SeleÃ§Ã£o Brasileira","morri em 2022","meu nome tem 4 letras"]},
    {"theme":"personalidades_negras","type":"normal","word":"Djamila Ribeiro","hints":["Sou uma filÃ³sofa, escritora e ativista","Escrevi o Pequeno Manual Antirracista","atuo no feminismo negro","meu sobrenome Ã© Ribeiro","fui secretÃ¡ria de Direitos Humanos em SP","meu nome comeÃ§a com â€œDâ€"]},
    {"theme":"personalidades_negras","type":"normal","word":"Michael Jackson","hints":["sou conhecido como o â€œRei do Popâ€","morri em 2009","â€œmoonwalkâ€ Ã© o meu passo de danÃ§a","eu tinha vitiligo","muitos nÃ£o me vÃªem como uma figura negra","Jackson Ã© o meu sobrenome"]},
    {"theme":"personalidades_negras","type":"normal","word":"Carolina Maria de Jesus","hints":["meu livro mais famoso Ã© um diÃ¡rio","Jesus Ã© o meu sobrenome","tenho nome composto","sou catadora de papel","aprendi a ler e escrever com os jornais coletados","sou mÃ£e de trÃªs filhos"]},
    {"theme":"personalidades_negras","type":"normal","word":"Zumbi dos Palmares","hints":["nasci no Quilombo dos Palmares","fui lÃ­der da resistÃªncia negra","lutei contra a escravidÃ£o","minha cabeÃ§a foi exposta em praÃ§a pÃºblica","Dia da ConsciÃªncia Negra (22 de novembro)","o meu nome tem â€œZumbiâ€"]},
    {"theme":"personalidades_negras","type":"normal","word":"Machado de Assis","hints":["sou o maior escritor brasileiro","ferramenta = nome","deixei um legado Ã­mpar na literatura","a minha negritude foi negada","Fundei a Academia Brasileira de Letras","tambÃ©m sou o bruxo do Cosme Velho"]},
    {"theme":"personalidades_negras","type":"normal","word":"LuÃ­s Gama","hints":["fui vendido como escravo","atuei como advogado","meu sobrenome tem â€œGamaâ€","fui poeta e advogado","meu nome quatro letras","â€œLâ€ Ã© a primeira letra do meu nome"]},
    {"theme":"personalidades_negras","type":"normal","word":"Milton Santos","hints":["estudei sobre a globalizaÃ§Ã£o","meu sobrenome Ã© â€œSantosâ€","ganhei o â€œNobel da Geografiaâ€","â€œMâ€ Ã© a primeira letra do meu nome","fui professor em vÃ¡rios paÃ­ses","sou o maior geÃ³grafo do Brasil"]},
    {"theme":"personalidades_negras","type":"normal","word":"Gilberto Gil","hints":["sou um dos maiores nomes da MPB","participei do movimento TropicÃ¡lia","minha carreira tem mais de 50 anos","meu sobrenome Ã© Gil","â€œDesde Que O Samba Ã‰ Sambaâ€","JÃ¡ ganhei Grammy Awards"]},
    {"theme":"personalidades_negras","type":"normal","word":"Elza Soares","hints":["sou uma cantora brasileira","princesa do filme Frozen","meu sobrenome Ã© Soares","sou considerada a rainha do samba","canto sobre empoderamento feminino","morri em 2022"]},
    {"theme":"personalidades_negras","type":"normal","word":"Marina Silva","hints":["superei a pobreza e o analfabetismo","fui senadora e ministra do meio ambiente","meu sobrenome Ã© Silva","disputei a PresidÃªncia da RepÃºblica","â€œMâ€ Ã© a primeira letra do meu nome","TROQUE DE LUGAR"]},
    {"theme":"personalidades_negras","type":"normal","word":"GlÃ³ria Maria","hints":["fui jornalista e apresentadora","apresentei o Jornal Nacional","recebi prÃªmios importantes da televisÃ£o","meu nome Ã© composto","o primeiro nome comeÃ§a com â€œGâ€","meu segundo nome Ã© Maria"]},
    {"theme":"personalidades_negras","type":"normal","word":"Iza","hints":["sou uma cantora brasileira","tenho mÃºsicas como Dona de Mim e PesadÃ£o","nasci no Rio de Janeiro","fui jurada no The Voice Brasil.","meu nome Ã© Isabela","sou conhecida pelo meu apelido"]},
    {"theme":"personalidades_negras","type":"normal","word":"Beatriz Souza","hints":["sou uma judoca brasileira","fui campeÃ£ pan-americana","compito na categoria +78 kg","inspiro jovens atletas e mulheres","meu apelido Ã© Bia","meu sobrenome Ã© Souza"]},
    {"theme":"personalidades_negras","type":"normal","word":"VinÃ­cius Junior","hints":["sou um jogador de futebol brasileiro","jogo pela SeleÃ§Ã£o Brasileira","enfrento diversos ataques racistas","jogo pelo Real Madrid","meu apelido Ã© mais famoso","inspiro jovens atletas"]},
    {"theme":"personalidades_negras","type":"normal","word":"Rebeca Andrade","hints":["sou uma ginasta","fui a 1Â° a ganhar medalha olÃ­mpica no individual geral","conquistei ouro no salto","tambÃ©m sou campeÃ£ mundial","recebi prÃªmios de melhor atleta","meu sobrenome Ã© Andrade"]},
    {"theme":"personalidades_negras","type":"normal","word":"Ronaldinho GaÃºcho","hints":["joguei no clube do GrÃªmio","fui considerado o Melhor Jogador do Mundo","meu nome Ã© Ronaldo","sou um jogador de futebol brasileiro","vÃ¡rios gols meus foram icÃ´nicos","sou conhecido pelo meu sorriso"]},
    {"theme":"personalidades_negras","type":"normal","word":"Djavan","hints":["â€œOceanoâ€ Ã© uma das minhas mÃºsicas","sou reconhecido internacionalmente","recebi vÃ¡rios prÃªmios musicais","sou um dos maiores nomes da MPB","componho letras poÃ©ticas e complexas","meu nome comeÃ§a com â€œDâ€"]},
    {"theme":"personalidades_negras","type":"normal","word":"Tim Maia","hints":["meu apelido Ã© uma rede de Internet","â€œAzul da Cor do Marâ€ Ã© a minha mÃºsica","meu sobrenome Ã© â€œMaiaâ€","sou muito conhecido pelo MPB","morri em 1998","influencio diferentes geraÃ§Ãµes"]},
    {"theme":"personalidades_negras","type":"normal","word":"PÃ©ricles","hints":["era vocalista do grupo Exaltasamba","â€œDeixa Acontecerâ€ Ã© a minha mÃºsica","sou conhecido pelo pagode romÃ¢ntico","participei do The Voice Brasil","meu nome comeÃ§a com â€œPâ€","faÃ§o mÃºsica hÃ¡ mais de 30 anos"]},

    // LOCAIS (normais)
    {"theme":"locais","type":"normal","word":"Museu Afro Brasil","hints":["Moro em SÃ£o Paulo","Nasci em 2004.","Emanoel AraÃºjo Ã© prÃ³ximo de mim.","Dizem que vivo de passado.","Dou Ãªnfase na valorizaÃ§Ã£o de aspectos da cultura de matriz africana.","Sou histÃ³rico, artÃ­stico e etnolÃ³gico"]},
    {"theme":"locais","type":"normal","word":"Quilombo da Rasa","hints":["Sou uma comunidade.","Moro no Rio de Janeiro.","Fui criada por escravizadas.","Me formei atravÃ©s da busca de terras para o cultivo.","Sofro com a especulaÃ§Ã£o imobiliÃ¡ria e a falta de reconhecimento de seus direitos Ã  terra.","Quilombo estÃ¡ no meu nome."]},
    {"theme":"locais","type":"normal","word":"Roda de Samba da Pedra do Sal","hints":["Surgi no Rio de Janeiro.","Originei-me no sÃ©culo XIX.","Preservo a heranÃ§a africana.","Roda estÃ¡ no meu nome.","Sou um sÃ­mbolo de resistÃªncia cultural.","Sou considerada o berÃ§o do samba."]},
    {"theme":"locais","type":"normal","word":"Quilombo dos Palmares","hints":["Sou uma comunidade autÃ´noma.","Nasci em Alagoas.","Originei-me no final do sÃ©culo XVI.","Fui destruÃ­da.","Zumbi Ã© um dos meus lÃ­deres","Tornei-me um sÃ­mbolo de resistÃªncia."]},
    {"theme":"locais","type":"normal","word":"Pelourinho","hints":["Sou um ponto turÃ­stico.","Moro em Salvador.","Sou conhecido pela arquitetura colonial barroca.","Meu nome faz referÃªncia ao lugar que criminosos e escravizados eram amarrados e punidos.","Por um tempo, fui um centro administrativo e comercial.","Fui erguido no sÃ©culo XVI."]},
    {"theme":"locais","type":"normal","word":"Soweto","hints":["Sou uma cidade.","Me tornei um sÃ­mbolo da luta contra o regime do apartheid.","Nasci em 1963.","Meu objetivo era agrupar bairros destinados aos negros.","Moro na Ãfrica do Sul.","Sou rica em cultura e histÃ³ria."]},
    {"theme":"locais","type":"normal","word":"Cachoeira","hints":["Estou localizada na Bahia.","Sou um centro de preservaÃ§Ã£o da memÃ³ria e das tradiÃ§Ãµes ancestrais.","Minha cidade Ã© um importante ponto comercial.","Mantenho viva a cultura africana.","Sou conhecida pela forÃ§a dos meus rituais religiosos.","Minha cultura Ã© o barroco."]},
    {"theme":"locais","type":"normal","word":"Museu Percurso do Negro","hints":["Sou um museu.","Estou localizado em Porto Alegre.","Rememorizo a histÃ³ria do povo negro.","Pessoas me visitam.","Interligo marcos histÃ³ricos.","Nasci em 2011."]},
    {"theme":"locais","type":"normal","word":"CafuÃ¡ das MercÃªs","hints":["Sou um museu.","Resido no MaranhÃ£o.","Fui originado no sÃ©culo XVIII.","Era um depÃ³sito de escravos para comercializaÃ§Ã£o.","Divulgo e preservo a histÃ³ria afrodescendente do meu estado.","Possuo peÃ§as e documentos relacionados Ã  histÃ³ria da escravidÃ£o no Brasil."]},
    {"theme":"locais","type":"normal","word":"Museu da AboliÃ§Ã£o","hints":["Sou um museu.","Moro em Recife.","Nasci em 1957.","Meu objetivo Ã© valorizar Ã  cultura e a histÃ³ria dos afrodescendentes.","Possuo objetos do antigo cotidiano de senhores e escravos.","A arte contemporÃ¢nea e objetos da etnia africana, sÃ£o prÃ³ximos de mim."]},
    {"theme":"locais","type":"normal","word":"PraÃ§a dos OrixÃ¡s","hints":["PraÃ§a dos OrixÃ¡s (referÃªncia cultural)","Local de manifestaÃ§Ãµes religiosas e culturais","Ligada Ã  religiosidade afro-brasileira","Ponto de encontro comunitÃ¡rio","Eventos religiosos e culturais ocorrem aqui","MemÃ³ria e ancestralidade"]},
    {"theme":"locais","type":"normal","word":"Centro Cultural Casa Ãfrica","hints":["Sou um Centro Cultural.","Meu objetivo Ã© preservar e divulgar uma cultura bastante conhecida.","Nasci em 2003.","Promovo palestras, exposiÃ§Ãµes e eventos turÃ­sticos.","Estou localizado em Belo Horizonte.","Nas sextas e sÃ¡bados ofereÃ§o gastronomia e mÃºsica."]},
    {"theme":"locais","type":"normal","word":"Casa dos Contos de Ouro Preto","hints":["Sou um museu.","Preservo e exponho a histÃ³ria econÃ´mica e fiscal do Brasil.","Abrigo uma senzala preservada.","Sou um marco do barroco mineiro.","Estou localizado em Ouro Preto.","Fui originado em 1974."]},
    {"theme":"locais","type":"normal","word":"Igreja de Nossa Senhora do RosÃ¡rio dos homens pretos","hints":["Estou localizada no Rio Grande do Norte.","Sou uma igreja.","Meu objetivo Ã©, no perÃ­odo colonial, promover um espaÃ§o acessÃ­vel a um grupo especÃ­fico.","Fui fundada em 1713.","Escravos negros me fundaram.","Sou um espaÃ§o de resistÃªncia e sociabilidade."]},
    {"theme":"locais","type":"normal","word":"Escola de samba Vai Vai","hints":["Sou conhecida como escola do povo.","Estou localizada em SÃ£o Paulo.","Fui fundada em 1930.","Sou a maior campeÃ£ do carnaval.","ClarÃ­cio GonÃ§alves Ã© prÃ³ximo de mim.","Sou um sÃ­mbolo da resistÃªncia da periferia e da diÃ¡spora africana."]},
    {"theme":"locais","type":"normal","word":"PraÃ§a Onze","hints":["Meu nome foi herdado de um antigo logradouro.","Estou localizada no Rio de Janeiro.","Antes, eu era conhecida como berÃ§o do Samba, que reunia comunidades negras e judaicas.","Meu nome Ã© em homenagem Ã  data da vitÃ³ria brasileira na Batalha do Riachuelo.","Minha Ã¡rea foi desapropriada e extinta, mas minha memÃ³ria cultural continua viva.","Sofri uma modernizaÃ§Ã£o em 1940."]},
    {"theme":"locais","type":"normal","word":"Cais do Valongo","hints":["Cais do Valongo â€” porto histÃ³rico.","Ligado ao trÃ¡fico negreiro no Rio de Janeiro.","Local de chegada forÃ§ada de africanos escravizados.","Importante marco da memÃ³ria negra no Brasil.","Reconhecido como patrimÃ´nio.","SÃ­mbolo de memÃ³ria e lutas."]},
    {"theme":"locais","type":"normal","word":"Cidade de Lagos","hints":["Sou uma cidade.","Estou localizada em Portugal.","Sou um dos pontos de partida das grandes navegaÃ§Ãµes portuguesas.","Possuo um rico patrimÃ³nio arquitetÃ³nico.","Na minha cultura, tenho traÃ§os da civilizaÃ§Ã£o Ã¡rabe.","Sofri um terremoto devastador em 1755."]},
    {"theme":"locais","type":"normal","word":"Vale do Rio Niger","hints":["Sou um Rio.","Moro na Africa Ocidental.","Possuo uma grande extensÃ£o.","Me tornei um centro de civilizaÃ§Ãµes antigas.","Minha criaÃ§Ã£o foi influenciada por colonizadores europeus.","Sou um local de intercÃ¢mbio cultural e histÃ³rico."]},
    {"theme":"locais","type":"normal","word":"PraÃ§a da SÃ©","hints":["Resido em SÃ£o Paulo.","Originei-me quando um lago foi reformado.","Sou um espaÃ§o pÃºblico.","Estou no banco imobiliÃ¡rio.","Sou uma praÃ§a.","Possui uma catedral com meu nome."]},

    // FATOS HISTÃ“RICOS (normais)
    {"theme":"fatos_historicos","type":"normal","word":"Marcha Nacional das Mulheres Negras","hints":["Ocorri em 2015.","Sou um movimento de organizaÃ§Ã£o polÃ­tica e social.","Mulheres negras me criaram.","Aconteci em BrasÃ­lia.","Meu objetivo Ã© denunciar o racismo e a desigualdade social.","Marcha Ã© uma parte do meu nome."]},
    {"theme":"fatos_historicos","type":"normal","word":"AprovaÃ§Ã£o da Lei Afonso Arinos","hints":["Ocorri em 1951.","O Congresso Nacional Ã© prÃ³ximo de mim.","Sou um marco para a luta antirracista.","Fui criada devido a uma situaÃ§Ã£o com uma bailarina afro-americana.","Sou uma aprovaÃ§Ã£o.","Meu nome Ã© composto por um substantivo prÃ³prio."]},
    {"theme":"fatos_historicos","type":"normal","word":"Revolta dos alfaiates","hints":["Sou uma revolta.","Ocorri em Salvador.","A independÃªncia do Haiti e uma crise social e econÃ´mica deram origem a mim.","Aconteci em 1798.","A publicaÃ§Ã£o de panfletos foi fundamental na organizaÃ§Ã£o da minha origem.","Classe pobre, soldados e a elite, me lideraram."]},
    {"theme":"fatos_historicos","type":"normal","word":"PromulgaÃ§Ã£o da Lei EuzÃ©bio de Queiroz","hints":["Ocorri em 1850.","Lei compÃµe o meu nome.","Proibi definitivamente o trÃ¡fico de africanos escravizados.","Aconteci no Rio de Janeiro.","D. Pedro II Ã© prÃ³ximo de mim.","Fui resultado da intensa pressÃ£o do Reino Unido."]},
    {"theme":"fatos_historicos","type":"normal","word":"Dia Nacional da ConsciÃªncia Negra","hints":["Celebro a resistÃªncia.","AconteÃ§o em Novembro.","Relembro a luta dos negros contra a opressÃ£o.","Sou um feriado nacional.","Ocorro no Brasil.","Fui criado por meio de uma lei."]},
    {"theme":"fatos_historicos","type":"normal","word":"Revolta da Chibata","hints":["Sou uma revolta.","Ocorri no Rio de Janeiro.","Sou uma rebeliÃ£o militar.","Fui originada em 1910.","Aconteci no dia que um presidente iria ser recebido.","Marinheiros me compÃµem."]},
    {"theme":"fatos_historicos","type":"normal","word":"Morte de Zumbi dos Palmares","hints":["Aconteci em 1695.","Palmares faz parte do meu nome.","A decapitaÃ§Ã£o me originou.","Aconteci na Serra da Barriga.","Tentaram fazer com que eu originasse diversas vezes.","Um lÃ­der Ã© relacionado a mim."]},
    {"theme":"fatos_historicos","type":"normal","word":"Revolta dos MalÃªs","hints":["Sou uma revolta.","Aconteci em Salvador","Ocorri em 1835.","Meu objetivo final era a libertaÃ§Ã£o e a liberdade religiosa.","Sou a maior revolta de escravizados da histÃ³ria brasileira.","Alguns dos envolvidos em minha origem, foram punidos severamente."]},
    {"theme":"fatos_historicos","type":"normal","word":"Movimento Negro Unificado","hints":["Sou uma organizaÃ§Ã£o ativista.","Ocorri em 1978.","Aconteci em SÃ£o Paulo.","Meu objetivo Ã© combater o racismo.","Fui motivada por eventos de discriminaÃ§Ã£o.","Sou a maior entidade negra da America Latina."]},
    {"theme":"fatos_historicos","type":"normal","word":"1Â° ConferÃªncia Nacional da PromoÃ§Ã£o da Igualidade Racial","hints":["Ocorri em BrasÃ­lia.","Aconteci em 2005.","Sou um evento.","Meu objetivo Ã© combater o racismo e outras formas de intolerÃ¢ncia.","Promovi o desenvolvimento de populaÃ§Ãµes tradicionais.","Valorizo a diversidade cultural brasileira."]},
    {"theme":"fatos_historicos","type":"normal","word":"CriaÃ§Ã£o da Frente Negra Brasileira","hints":["Meu objetivo Ã© reivindicar melhores condiÃ§Ãµes de vida para os negros.","Ocorri em 1931.","Aconteci em SÃ£o Paulo.","Meu objetivo Ã© organizar a igualdade de direitos.","Sou a primeira organizaÃ§Ã£o negra do Brasil.","Acredito que a soluÃ§Ã£o para o paÃ­s Ã© um governo forte que tenha compromisso com a naÃ§Ã£o."]},
    {"theme":"fatos_historicos","type":"normal","word":"Apartheid na Ãfrica do Sul","hints":["Sou um regime polÃ­tico.","Ocorri entre 1948 e 1994.","Aconteci na Ãfrica do Sul.","Fui sustentado pelo Partido Nacional e por um partido de extrema-direita.","Fiz com que um paÃ­s sofresse uma forte pressÃ£o internacional.","NÃ£o fui criado por uma Ãºnica pessoa, mas sim por um sistema legal imposto pelas elites brancas."]},
    {"theme":"fatos_historicos","type":"normal","word":"Movimento Black Power","hints":["Aconteci nos Estados Unidos.","Ocorri no ano de 1960.","Sou um movimento polÃ­tico cultural.","Promovo a valorizaÃ§Ã£o da cultura e da beleza negra.","Reinvidico a igualdade racial.","Surgi a partir de outro movimento."]},
    {"theme":"fatos_historicos","type":"normal","word":"AboliÃ§Ã£o da EscravidÃ£o nos EUA","hints":["Sou um processo legalizado.","Ocorri nos Estados Unidos.","Fui originada atravÃ©s da a ratificaÃ§Ã£o da 13Âª Emenda Ã  ConstituiÃ§Ã£o.","Aconteci no ano de 1865.","Acabei com um dos maiores sistemas de produÃ§Ã£o escravistas.","Sou a anulaÃ§Ã£o de algo cruel."]},
    {"theme":"fatos_historicos","type":"normal","word":"Panteras Negras","hints":["Sou uma organizaÃ§Ã£o socialista.","Ocorri nos Estados Unidos.","Aconteci em 1966.","Bobby Seale e Huey Newton sÃ£o responsÃ¡veis por mim.","Surgi da insatisfaÃ§Ã£o com as tÃ¡ticas dos direitos civis.","Implantei programas comunitÃ¡rios."]},
    {"theme":"fatos_historicos","type":"normal","word":"Massacre de Soweto","hints":["Sou fruto da rebeliÃ£o negra.","Ocorri na Ãfrica do Sul.","Aconteci em 1976.","15.000 pessoas morreram por minha causa.","Fui desencadeado pela repressÃ£o policial Ã  passeata.","Sou um episÃ³dio sangrento."]},
    {"theme":"fatos_historicos","type":"normal","word":"CriaÃ§Ã£o do Estatuto de Igualdade Racial","hints":["Fui originado em BrasÃ­lia.","Aconteci em 2010.","Meu objetivo Ã© combater a discriminaÃ§Ã£o racial.","Igualdade estÃ¡ presente no meu nome.","Sou um Estatuto.","Quero assegurar o acesso pleno aos direitos fundamentais."]},

    // OBRAS (normais)
    {"theme":"obras","type":"normal","word":"Quarto de Despejo","hints":["eu fui publicado em 1960","o sobrenome da autora Ã© Jesus","sou um livro autobiogrÃ¡fico","a escritora era moradora da favela","tenho vÃ¡rios erros ortogrÃ¡ficos","a autora era catadora de papel"]},
    {"theme":"obras","type":"normal","word":"Olhos D'Ã¡gua","hints":["meu nome tem a palavra \"Ã¡gua\"","o povo afro-brasileiro Ã© o meu foco","no meu tÃ­tulo hÃ¡ um Ã³rgÃ£o da visÃ£o","sou um livro com 15 contos","a autora se chama ConceiÃ§Ã£o Evaristo","na capa hÃ¡ uma olho castanho."]},
    {"theme":"obras","type":"normal","word":"Pequeno Manual Antirracista","hints":["violÃªncia, branquitude e cultura Ã© o meu foco","sou um livro/manual","Djamila Ribeiro Ã© a autora","AVANCE DUAS CASAS","a escritora Ã© feminista, filÃ³sofa e ativista","a minha capa Ã© amarela"]},
    {"theme":"obras","type":"normal","word":"Rap da Felicidade","hints":["Cidinho e Doca sÃ£o os cantores","meu gÃªnero nÃ£o Ã© o Rap, embora tenha no tÃ­tulo","abordo as desigualdades que hÃ¡ nas favelas","busco a minha felicidade","â€œEu sÃ³ quero Ã© ser felizâ€¦â€","foco na violÃªncia do Rio de Janeiro"]},
    {"theme":"obras","type":"normal","word":"AmarElo","hints":["o meu nome Ã© uma cor primÃ¡ria","sou uma canÃ§Ã£o pop","tem relaÃ§Ã£o com o setembro amarelo","mostro a realidade das favelas","â€œamar Ã© um eloâ€¦â€","Emicida Ã© o cantor da mÃºsica"]},
    {"theme":"obras","type":"normal","word":"King Richard: Criando CampeÃ£s","hints":["um pai cria as campeÃ£s do tÃªnis","nome do pai: Richard Williams","no tÃ­tulo tem a palavra rei em inglÃªs","relato a histÃ³ria das irmÃ£s Willams","Richard cria as lendas do tÃªnis","sou um filme baseado em fatos reais"]},
    {"theme":"obras","type":"normal","word":"O Menino que Descobriu o Vento","hints":["narro a construÃ§Ã£o da turbina eÃ³lica","mostro a realidade da fome e seca","filme baseado em fatos reais","no tÃ­tulo tem a palavra â€œventoâ€","ocorreu no vilarejo do Malawi","um garoto construiu uma turbina"]},
    {"theme":"obras","type":"normal","word":"Pantera Negra","hints":["sou um filme da Marvel","conto a histÃ³ria de um Super-herÃ³i","tambÃ©m sou um animal","velocidade Ã© o meu poder","meu traje Ã© preto com pedras prateadas","tambÃ©m sou o mascote do IF (CNAT)"]},
    {"theme":"obras","type":"normal","word":"Cidade de Deus","hints":["o meu nome Ã© o mesmo de uma favela carioca","BuscapÃ© Ã© o narrador","mostro a desigualdade e a violÃªncia","a palavra â€œDeusâ€ estÃ¡ no meu tÃ­tulo","sou um filme baseado em fatos reais","Fui indicado ao Oscar"]},
    {"theme":"obras","type":"normal","word":"Ã€ Procura da Felicidade","hints":["sou um filme baseado em fatos reais","no meu tÃ­tulo tem um tipo de sentimento","um pai estÃ¡ Ã  procura de algo","a desigualdade financeira Ã© o meu foco","sou estrelado por Will Smith e Jaden Smith","mostro que o abandono nÃ£o Ã© a soluÃ§Ã£o"]},
    {"theme":"obras","type":"normal","word":"Estrelas AlÃ©m do Tempo","hints":["as protagonistas sÃ£o matemÃ¡ticas afro-americanas","mostro o preconceito racial e de gÃªnero","mulheres que mudaram a NASA","sou um filme baseado em fatos reais","â€œesse banheiro nÃ£o Ã© para pessoas negrasâ€¦â€","no tÃ­tulo tem a palavra â€œEstrelasâ€"]},
    {"theme":"obras","type":"normal","word":"A Princesa e o Sapo","hints":["sou um filme infantil da Disney","o beijo transforma as pessoas","o protagonista Ã© um sapo","o nome da princesa Ã© Tiana","no meu tÃ­tulo hÃ¡ dois personagens","mostro a vida de uma mulher trabalhadora"]},
    {"theme":"obras","type":"normal","word":"Vidas Negras Importam","hints":["o meu gÃªnero Ã© o samba","refrÃ£o: â€œuma vida negra importaâ€","refrÃ£o + plural = tÃ­tulo","a letra denuncia o racismo estrutural","sou uma resposta ao movimento Black Lives Matter","no meu tÃ­tulo tem a palavra â€œVidasâ€"]},
    {"theme":"obras","type":"normal","word":"Navio negreiro","hints":["sou uma poesia abolicionista em mÃºsica","falo sobre o trÃ¡fico negreiro","no meu tÃ­tulo tem a palavra â€œnavioâ€","Descrevo a travessia dos negros africano","Navio + negreiro = tÃ­tulo","mostro o sofrimento dos escravos"]},
    {"theme":"obras","type":"normal","word":"O CortiÃ§o","hints":["Sou um livro de romance naturalista","mostro a exploraÃ§Ã£o e o preconceito racial","Meu autor Ã© AluÃ­sio Azevedo","sou um cortiÃ§o no Rio de Janeiro.","o meu tÃ­tulo tem a palavra â€œCortiÃ§oâ€","JoÃ£o RomÃ£o e Bertoleza sÃ£o os personagens principais"]},
    {"theme":"obras","type":"normal","word":"This is America","hints":["sou uma mÃºsica do autor Childish Gambino.","o refrÃ£o Ã© â€œThis is Americaâ€","retraro a violÃªncia e o racismo","foco das desigualdades do EUA","refrÃ£o = tÃ­tulo","meu tÃ­tulo denuncia os americanos"]},
    {"theme":"obras","type":"normal","word":"Cotas","hints":["mostro a desigualdade social e racial","Meu autor e intÃ©rprete Ã© o Criolo","Trago a importÃ¢ncia das cotas raciais","a letra critica os preconceitos raciais","aponto uma forte mensagem polÃ­tica","tÃ­tulo = cotas"]},
    {"theme":"obras","type":"normal","word":"12 Anos de EscravidÃ£o","hints":["Mostro a crueldade da escravidÃ£o nos EUA","Ganhei o Oscar de Melhor Filme","no meu tÃ­tulo tem a palavra â€œEscravidÃ£oâ€","o personagem ficou 12 anos escravizado","sou um filme baseado em fatos reais","12 anos + EscravidÃ£o = tÃ­tulo"]},
    {"theme":"obras","type":"normal","word":"Pelas Ruas do Brasil","hints":["mostro as desigualdades nas ruas brasileiras","sou um livro de crÃ´nicas e relatos","trago as lutas e a resistÃªncia dos brasileiros","o tÃ­tulo fala de andar pelas cidades","meu autor Ã© Eliane Brum","Pela Ruas + Brasil = tÃ­tulo"]},
    {"theme":"obras","type":"normal","word":"Que Horas Ela Volta?","hints":["mostro a desigualdade entre patrÃµes e empregados","o tÃ­tulo faz uma pergunta sobre horÃ¡rio","questiono as regras de classe e os privilÃ©gios.","a protagonista se chama Val","de forma crÃ­tica e sensÃ­vel trago as â‰  sociais","horÃ¡rio + ela volta? = tÃ­tulo"]},
  ];

  // reset pools and push
  cardPools = { personalidades_negras: [], locais: [], fatos_historicos: [], obras: [] };
  all.forEach(c => cardPools[c.theme].push(c));

  // especiais (um em cada pilha) â€” intensificados
  const special1 = {
    theme:'locais', type:'special', title:'BÃšSSOLA LIBERTADORA',
    question:null, choices:null, answer:null,
    effect:{kind:'instant', value:+10, text:'+10 pts para quem tirou a carta (BÃºssola Libertadora)'}
  };
  const special2 = {
    theme:'personalidades_negras', type:'special', title:'MAPA COM MEMÃ“RIA',
    question:'De que forma incluir sÃ­mbolos da cultura afro-brasileira em mapas escolares pode promover uma educaÃ§Ã£o antirracista?',
    choices:[
      'Valoriza territÃ³rios, tradiÃ§Ãµes e referÃªncias culturais negras, antes invisibilizadas.',
      'Padroniza sÃ­mbolos sem relaÃ§Ã£o cultural',
      'Aumenta o custo da produÃ§Ã£o de mapas',
      'Substitui a geografia regional por temas globais'
    ],
    answer:0,
    effect:{kind:'map_memory', winValue:+15, loseValue:-5, text:'+15 pts para quem respondeu; -5 para os outros quando a cor escolhida aparecer'}
  };
  const special3 = {
    theme:'fatos_historicos', type:'special', title:'OBJETO LIBERTADOR',
    question:'Qual instrumento substituiu a observaÃ§Ã£o das estrelas na navegaÃ§Ã£o moderna?',
    choices:['BÃºssola','AstrolÃ¡bio','Mapa celeste','RÃ©gua nÃ¡utica'],
    answer:0,
    effect:{kind:'first_green_penalty', penalty:-20, text:'O primeiro (entre os outros) que tirar verde perde -20 pts'}
  };
  const special4 = {
    theme:'obras', type:'special', title:'LUZ DA RESISTÃŠNCIA',
    question:'Como a orientaÃ§Ã£o foi usada tanto na navegaÃ§Ã£o quanto na fuga de pessoas escravizadas?',
    choices:[
      'No trÃ¡fico negreiro pelos colonizadores e os astros para guiar as fugas dos escravizados.',
      'Apenas instrumentos mecÃ¢nicos eram usados na navegaÃ§Ã£o moderna.',
      'Somente mapas foram relevantes; astros nÃ£o tiveram papel.',
      'A orientaÃ§Ã£o nÃ£o teve relaÃ§Ã£o com fugas ou navegaÃ§Ã£o.'
    ],
    answer:0,
    effect:{kind:'color_effect', mapping:{
      0:{type:'penalize_other', value:-15, text:'Roxo â†’ escolha alguÃ©m para perder -15 pts'},
      1:{type:'swap_with_leader', text:'Laranja â†’ troque pontuaÃ§Ã£o com o jogador mais prÃ³ximo da vitÃ³ria'},
      2:{type:'gain_self', value:+20, text:'Verde â†’ vocÃª ganha +20 pts'},
      3:{type:'lose_turn', text:'Azul â†’ escolha alguÃ©m para perder a vez (prÃ³xima rodada)'}
    }}
  };

  cardPools['locais'].push(special1);
  cardPools['personalidades_negras'].push(special2);
  cardPools['fatos_historicos'].push(special3);
  cardPools['obras'].push(special4);

  log('Cartas carregadas (incluindo 4 especiais).');
}

/* Dado */
function rollDie(){
  if(!gameActive) return alert('Inicie uma nova partida (Nova partida) e adicione jogadores.');
  const player = players[currentPlayerIndex];
  if(player.lostTurn){
    player.lostTurn = false;
    log(`${player.name} perdeu a vez (flag). A vez foi consumida.`);
    nextTurn();
    return;
  }
  optionsLocked = false;
  clearCardDisplay();
  const face = Math.floor(Math.random()*6);
  dieLastFace = face;
  showDieFace(face);
  if(face >=0 && face <=3){
    const themeKey = THEMES[face].key;
    log(`${player.name} tirou o dado â†’ tema: ${THEMES[face].label}`);
    drawCard(themeKey);
  } else if(face === 4){
    player.lostTurn = true;
    log(`${player.name} tirou PERDE A VEZ â†’ perderÃ¡ a prÃ³xima vez.`);
    updateStatus();
    setTimeout(nextTurn, 700);
  } else {
    const theme = $('manualTheme').value;
    const label = THEMES.find(t=>t.key===theme)?.label || theme;
    log(`${player.name} tirou ESCOLHA SEU TEMA â†’ escolheu ${label}`);
    drawCard(theme);
  }
}
function showDieFace(face){
  if(face>=0 && face<=3){
    dieFaceEl.innerHTML = `Face: ${THEMES[face].label} <span style="display:inline-block;width:14px;height:14px;border-radius:4px;background:${THEMES[face].color};margin-left:8px"></span>`;
  } else if(face===4) dieFaceEl.textContent = 'Face: PERDE A VEZ';
  else dieFaceEl.textContent = 'Face: ESCOLHA SEU TEMA';
}

/* Sorteio da carta; remove do baralho; prepara view */
function drawCard(themeKey){
  const pool = cardPools[themeKey] || [];
  if(pool.length === 0) { alert('Sem cartas nesse tema.'); return; }
  const idx = Math.floor(Math.random()*pool.length);
  currentCard = pool.splice(idx,1)[0];
  hintsUsed = 0;
  currentCardPoints = 0;
  prepareCardView(currentCard, themeKey);
}

function prepareCardView(card, themeKey){
  optionsLocked = false;
  cardTitle.textContent = card.type === 'special' ? `Carta Especial â€” ${card.title || 'Especial'}` : `Tema â€” ${themeKey.toUpperCase().replace('_',' ')}`;
  cardMeta.textContent = card.type === 'special' ? (card.effect?.text || '') : `Adivinhe: escreva o nome da palavra em questÃ£o`;
  // clear areas
  optionsEl.innerHTML = '';
  guessArea.style.display = 'none';
  // normal cards -> show first hint (if exists), show guess area
  if(card.type === 'normal'){
    guessArea.style.display = 'block';
    if(card.hints && card.hints.length > 0){
      hintsUsed = 1;
      currentHintEl.textContent = card.hints[0];
    } else {
      hintsUsed = 0;
      currentHintEl.textContent = 'Sem dicas disponÃ­veis.';
    }
    currentCardPoints = computePoints();
    hintsUsedEl.textContent = hintsUsed;
    cardPointsEl.textContent = currentCardPoints;
  } else {
    // special: show question and multiple choice buttons (single attempt)
    guessArea.style.display = 'none';
    if(card.question){
      currentHintEl.textContent = card.question;
    } else {
      currentHintEl.textContent = card.effect?.text || '';
    }
    // build choices only for specials that have choices; instant specials get a single "Ativar" button
    if(card.choices && card.choices.length){
      renderOptionsForSpecial(card, card.choices, card.answer);
    } else if(card.question && (!card.choices || card.choices.length === 0)){
      // fallback: show 4 generic options (not ideal but keeps UI consistent)
      const fallback = ['OpÃ§Ã£o A','OpÃ§Ã£o B','OpÃ§Ã£o C','OpÃ§Ã£o D'];
      renderOptionsForSpecial(card, fallback, card.answer !== undefined ? card.answer : 0);
    } else {
      // instant effect
      renderOptionsForSpecial(card, ['Ativar carta (sem escolha mÃºltipla)'], 0, true);
    }
  }
  updateStatus();
}

/* Render multiple-choice for special cards only */
function renderOptionsForSpecial(card, choices, correctIndex, instant=false){
  optionsEl.innerHTML = '';
  choices.forEach((c,i)=>{
    const btn = document.createElement('button');
    btn.className = 'opt-btn';
    btn.textContent = c;
    btn.disabled = false;
    btn.addEventListener('click', ()=>{
      if(optionsLocked) return;
      optionsLocked = true;
      if(instant){
        log(`${players[currentPlayerIndex].name} ativou a carta especial "${card.title}".`);
        applySpecialEffect(card, true);
      } else {
        const correct = (i === correctIndex);
        if(correct){
          log(`${players[currentPlayerIndex].name} escolheu a alternativa correta na carta especial "${card.title}".`);
          applySpecialEffect(card, true);
        } else {
          log(`${players[currentPlayerIndex].name} escolheu alternativa INCORRETA na carta especial "${card.title}".`);
          // incorrect -> no effect; next player's turn
          setTimeout(nextTurn, 600);
        }
      }
    });
    optionsEl.appendChild(btn);
  });
  const note = document.createElement('div');
  note.style.color = 'var(--muted)';
  note.style.fontSize = '13px';
  note.style.marginTop = '6px';
  note.textContent = 'Nas cartas especiais: escolha apenas UMA opÃ§Ã£o (uma chance).';
  optionsEl.appendChild(note);
}

/* Palpite livre para cartas normais */
function submitGuess(){
  if(!currentCard) return alert('Gire o dado e tire uma carta primeiro.');
  if(currentCard.type !== 'normal') return alert('Este campo Ã© apenas para cartas normais. Use as alternativas para cartas especiais.');
  const guessRaw = guessInput.value.trim();
  if(!guessRaw) return alert('Digite seu palpite.');
  const player = players[currentPlayerIndex];
  const target = currentCard.word || '';
  const ok = tolerantMatch(guessRaw, target);
  if(ok){
    const pts = computePoints();
    player.score += pts;
    log(`${player.name} acertou "${target}" e ganhou +${pts} pts.`);
    checkVictory(player);
    guessInput.value='';
    renderPlayers();
    setTimeout(nextTurn,600);
  } else {
    log(`${player.name} errou (digitou "${guessRaw}").`);
    guessInput.value='';
    // allow retries for normal cards (user didn't restrict), but you can change this if you want one attempt only for normals.
    setTimeout(nextTurn,600);
  }
  updateStatus();
}

/* Dicas e revelar (normais) */
function askHint(){
  if(!currentCard) return alert('Gire o dado para tirar uma carta primeiro.');
  if(currentCard.type === 'special'){ alert('Cartas especiais nÃ£o tÃªm dicas sequenciais. Responda pela alternativa.'); return; }
  const hints = currentCard.hints || [];
  if(hintsUsed >= hints.length){ alert('Sem mais dicas.'); return; }
  hintsUsed++;
  currentHintEl.textContent = hints[hintsUsed-1] || 'â€”';
  currentCardPoints = computePoints();
  hintsUsedEl.textContent = hintsUsed;
  cardPointsEl.textContent = currentCardPoints;
}
function revealWord(){
  if(!currentCard) return alert('Gire o dado primeiro.');
  if(currentCard.type === 'special'){ alert('Carta especial â€” nÃ£o hÃ¡ "revelar palavra".'); return; }
  // reveal by showing correct word in currentHint and set points to 0
  currentHintEl.textContent = `Resposta: ${currentCard.word || 'â€”'}`;
  currentCardPoints = 0;
  hintsUsed = currentCard.hints ? currentCard.hints.length : 0;
  hintsUsedEl.textContent = hintsUsed;
  cardPointsEl.textContent = currentCardPoints;
  log(`${players[currentPlayerIndex].name} revelou a palavra (0 pts).`);
  setTimeout(nextTurn,700);
}

/* compute points (based on hintsUsed) */
function computePoints(){ const used = Math.max(1, hintsUsed || 1); return POINT_MAP[Math.min(used-1, POINT_MAP.length-1)]; }

/* Aplica efeitos das cartas especiais (mesma lÃ³gica da versÃ£o anterior) */
function applySpecialEffect(card, answeredCorrectly){
  const player = players[currentPlayerIndex];
  const eff = card.effect || {};
  const kind = eff.kind;
  if(kind === 'instant'){
    player.score += eff.value || 0;
    log(`${player.name} recebeu ${eff.value} pts (efeito instantÃ¢neo).`);
    checkVictory(player);
    setTimeout(nextTurn,700);
    return;
  }
  if(kind === 'map_memory' && answeredCorrectly){
    const raw = prompt('Escolha uma cor: Roxo, Laranja, Verde, Azul', 'Roxo') || 'Roxo';
    const pick = raw.trim().toLowerCase();
    const mapping = {'roxo':0,'laranja':1,'verde':2,'azul':3};
    const pickIdx = mapping[pick];
    if(pickIdx === undefined){ alert('Escolha invÃ¡lida â€” efeito cancelado.'); setTimeout(nextTurn,400); return; }
    log(`${player.name} escolheu a cor ${pick} para MAPA COM MEMÃ“RIA.`);
    players.forEach((p,i)=>{
      const face = Math.floor(Math.random()*6);
      showDieFace(face);
      log(`${p.name} rolou (evento MAP) â†’ ${faceLabel(face)}`);
      if(face === pickIdx){
        if(p === player){
          p.score += eff.winValue;
          log(`${p.name} (respondente) ganhou +${eff.winValue} pts.`);
        } else {
          p.score += eff.loseValue;
          log(`${p.name} perdeu ${Math.abs(eff.loseValue)} pts.`);
        }
      }
    });
    renderPlayers();
    setTimeout(nextTurn,700);
    return;
  }
  if(kind === 'first_green_penalty' && answeredCorrectly){
    log(`Ativando OBJETO LIBERTADOR: outros jogadores rolam atÃ© alguÃ©m tirar VERDE; primeiro a tirar VERDE perde ${Math.abs(eff.penalty)} pts.`);
    const others = players.map((p,i)=>({p,i})).filter(o=>o.i !== currentPlayerIndex);
    if(others.length === 0){ log('Sem outros jogadores. Efeito sem alvo.'); setTimeout(nextTurn,700); return; }
    let found=false; let rounds=0;
    while(!found && rounds < 200){
      for(const o of others){
        rounds++;
        const face = Math.floor(Math.random()*6);
        showDieFace(face);
        log(`${o.p.name} rolou (tenta #${rounds}) â†’ ${faceLabel(face)}`);
        if(face === 2){
          o.p.score += eff.penalty;
          log(`${o.p.name} tirou VERDE primeiro e recebeu ${eff.penalty} pts.`);
          found = true;
          break;
        }
      }
    }
    if(!found) log('NinguÃ©m tirou VERDE dentro do limite. Efeito cancelado.');
    renderPlayers();
    setTimeout(nextTurn,700);
    return;
  }
  if(kind === 'color_effect' && answeredCorrectly){
    const face = Math.floor(Math.random()*4);
    showDieFace(face);
    const mapping = eff.mapping || {};
    const action = mapping[face];
    log(`${player.name} ativou LUZ DA RESISTÃŠNCIA e rolou cor ${faceLabel(face)}.`);
    if(!action){ log('Nenhuma aÃ§Ã£o definida para essa cor.'); setTimeout(nextTurn,700); return; }

    if(action.type === 'penalize_other'){
      const name = prompt(`Roxo: escolha alguÃ©m para perder ${Math.abs(action.value)} pts (digite o nome)`);
      const target = players.find(p=>p.name.toLowerCase() === (name||'').toLowerCase());
      if(target){ target.score += action.value; log(`${target.name} perdeu ${Math.abs(action.value)} pts.`); }
      else { const idx = (currentPlayerIndex + 1) % players.length; players[idx].score += action.value; log(`${players[idx].name} (padrÃ£o) perdeu ${Math.abs(action.value)} pts.`); }
    } else if(action.type === 'swap_with_leader'){
      let leaderIdx = null; let best = -Infinity;
      players.forEach((p,i)=>{ if(i!==currentPlayerIndex && p.score > best){ best=p.score; leaderIdx=i; }});
      if(leaderIdx !== null){
        const tmp = players[leaderIdx].score;
        players[leaderIdx].score = players[currentPlayerIndex].score;
        players[currentPlayerIndex].score = tmp;
        log(`${player.name} trocou pontuaÃ§Ã£o com ${players[leaderIdx].name}.`);
      } else log('Nenhum jogador para trocar.');
    } else if(action.type === 'gain_self'){
      player.score += action.value;
      log(`${player.name} ganhou +${action.value} pts (Verde).`);
      checkVictory(player);
    } else if(action.type === 'lose_turn'){
      const name = prompt('Azul: escolha alguÃ©m para perder a vez (digite o nome)');
      const idx = players.findIndex(p=>p.name.toLowerCase() === (name||'').toLowerCase());
      if(idx >= 0){ players[idx].lostTurn = true; log(`${players[idx].name} perderÃ¡ a prÃ³xima vez.`); }
      else { const fallback = (currentPlayerIndex+1) % players.length; players[fallback].lostTurn = true; log(`${players[fallback].name} (padrÃ£o) perderÃ¡ a prÃ³xima vez.`); }
    }
    renderPlayers();
    setTimeout(nextTurn,700);
    return;
  }

  log('Carta especial processada (padrÃ£o).');
  setTimeout(nextTurn,700);
}

/* helpers e fluxo de turno */
function askHint(){ if(!currentCard) return alert('Gire o dado antes.'); if(currentCard.type==='special'){ alert('Cartas especiais nÃ£o tÃªm dicas sequenciais. Responda pela alternativa.'); return; } const hints = currentCard.hints || []; if(hintsUsed >= hints.length){ alert('Sem mais dicas.'); return; } hintsUsed++; currentHintEl.textContent = hints[hintsUsed-1] || 'â€”'; currentCardPoints = computePoints(); hintsUsedEl.textContent = hintsUsed; cardPointsEl.textContent = currentCardPoints; }
function revealWord(){ if(!currentCard) return alert('Gire o dado primeiro.'); if(currentCard.type==='special'){ alert('Carta especial â€” nÃ£o hÃ¡ revelar.'); return; } currentHintEl.textContent = `Resposta: ${currentCard.word || 'â€”'}`; currentCardPoints = 0; hintsUsed = currentCard.hints ? currentCard.hints.length : 0; hintsUsedEl.textContent = hintsUsed; cardPointsEl.textContent = currentCardPoints; log(`${players[currentPlayerIndex].name} revelou (0 pts).`); setTimeout(nextTurn,700); }
function computePoints(){ const used = Math.max(1, hintsUsed || 1); return POINT_MAP[Math.min(used-1, POINT_MAP.length-1)]; }
function nextTurn(){ if(!gameActive) return; currentCard = null; hintsUsed = 0; currentCardPoints = 0; optionsLocked = false; currentPlayerIndex = (currentPlayerIndex + 1) % players.length; updateStatus(); log(`Vez de ${players[currentPlayerIndex].name}.`); }
function updateStatus(){ const cur = players[currentPlayerIndex]; turnLabel.textContent = cur ? cur.name : 'â€”'; scoreLabel.textContent = cur ? cur.score : 'â€”'; hintsUsedEl.textContent = hintsUsed; cardPointsEl.textContent = currentCardPoints; if(!currentCard){ cardTitle.textContent = 'â€”'; cardMeta.textContent = 'Gire o dado para escolher tema e tirar uma carta.'; currentHintEl.textContent = 'â€”'; optionsEl.innerHTML = ''; guessArea.style.display = 'none'; } renderPlayers(); renderScoreboard(); }
function startNewGame(){ if(players.length === 0) return alert('Adicione ao menos um jogador antes de iniciar.'); players.forEach(p=>{ p.score = 0; p.lostTurn = false; }); currentPlayerIndex = 0; gameActive = true; currentCard = null; hintsUsed = 0; currentCardPoints = 0; optionsLocked = false; loadAllCards(); renderPlayers(); log('Nova partida iniciada.'); updateStatus(); }
function endGame(){ gameActive = false; alert('Partida encerrada.'); }
function clearCardDisplay(){ cardTitle.textContent='â€”'; cardMeta.textContent='â€”'; currentHintEl.textContent='â€”'; optionsEl.innerHTML=''; guessArea.style.display='none'; hintsUsedEl.textContent='0'; cardPointsEl.textContent='0'; }
function faceLabel(face){ if(face>=0 && face<=3) return THEMES[face].label; if(face===4) return 'PERDE A VEZ'; return 'ESCOLHA SEU TEMA'; }
function checkVictory(player){ if(player.score >= GOAL){ player.score = GOAL; renderPlayers(); alert(`${player.name} atingiu ${GOAL} pts e venceu!`); gameActive=false; } }

/* tolerant match (normalize + levenshtein) for normal card guesses */
function normalizeText(s){ return String(s).normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/[^\w\s]/g,'').toLowerCase().trim(); }
function levenshtein(a,b){ const m=a.length,n=b.length; const dp=Array.from({length:m+1},()=>Array(n+1).fill(0)); for(let i=0;i<=m;i++)dp[i][0]=i; for(let j=0;j<=n;j++)dp[0][j]=j; for(let i=1;i<=m;i++){ for(let j=1;j<=n;j++){ const cost = a[i-1]===b[j-1]?0:1; dp[i][j]=Math.min(dp[i-1][j]+1, dp[i][j-1]+1, dp[i-1][j-1]+cost); }} return dp[m][n]; }
function tolerantMatch(a,b){ const A=normalizeText(a), B=normalizeText(b); if(!B) return false; if(A===B) return true; if(A.includes(B) || B.includes(A)) return true; const dist = levenshtein(A,B); const tol = Math.max(1, Math.floor(B.length * 0.25)); return dist <= tol; }

/* inicializaÃ§Ã£o */
loadAllCards();
updateStatus();
log('Jogo pronto. Adicione jogadores e clique em "Nova partida".');

</script>
</body>
</html>
